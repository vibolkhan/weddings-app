<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8" />
  <title>Admin â€¢ Guests</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="./assets/css/style.css" rel="stylesheet" />
  <link href="./assets/css/login.css" rel="stylesheet" />
</head>

<body class="bg app">
  <header class="app-header">
    <div class="brand">Wedding Admin</div>
    <nav class="nav">
      <button id="logoutBtn" class="btn subtle">Logout</button>
    </nav>
  </header>

  <main class="container">
    <section class="panel">
      <h2>Guests</h2>

      <form id="guestForm" class="row">
        <input id="guestName" type="text" placeholder="Guest name" required />
        <select id="guestStatus">
          <option value="invited">Invited</option>
          <option value="confirmed">Confirmed</option>
          <option value="declined">Declined</option>
          <option value="unknown">Unknown</option>
        </select>
        <button class="btn" type="submit">Add guest</button>
      </form>

      <div class="table-wrap">
        <table class="table" id="guestTable">
          <thead>
            <tr>
              <th style="width:42%">Name</th>
              <th style="width:18%">Status</th>
              <th style="width:24%">Invite Link</th>
              <th style="width:16%">Actions</th>
            </tr>
          </thead>
          <tbody id="guestTbody">
            <!-- rows injected by JS -->
          </tbody>
        </table>
      </div>
    </section>
  </main>

  <script>
    const API_BASE = 'http://localhost:4000/api';
    const token = localStorage.getItem('jwt');
    if (!token) window.location.href = './login.html';

    async function api(path, options = {}) {
      const headers = Object.assign(
        { 'Content-Type': 'application/json', 'Authorization': `Bearer ${token}` },
        options.headers || {}
      );
      const res = await fetch(`${API_BASE}${path}`, { ...options, headers });
      if (res.status === 401) {
        localStorage.removeItem('jwt');
        localStorage.removeItem('user');
        window.location.href = './login.html';
        return;
      }
      const data = await res.json();
      if (!res.ok) throw new Error(data?.error || 'Request failed');
      return data;
    }

    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('jwt');
      localStorage.removeItem('user');
      window.location.href = './login.html';
    });
  </script>

  <script src="./assets/js/admin.js"></script>
</body>

</html>
